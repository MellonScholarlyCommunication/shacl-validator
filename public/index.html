<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SHACL Validator</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 0 20px; }
    textarea { width: 100%; height: 250px; font-family: monospace; }
    .actions { margin-top: 10px; display: flex; gap: 10px; align-items: center; }
    #output { margin-top: 15px; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; min-height: 50px; white-space: pre-wrap; }
    .error { color: red; }
    label { font-weight: bold; display: block; margin-bottom: 5px; }
    .section { margin-bottom: 20px; }
    .file-input-wrapper { background: #eee; padding: 15px; border-radius: 4px; border: 1px dashed #999; }
  </style>
</head>
<body>

  <h2>SHACL Validator</h2>

  <div class="section file-input-wrapper">
    <label for="filePicker">Step 1: Upload a File (optional):</label>
    <input type="file" id="filePicker" accept=".jsonld,.json,.ttl,.nt" />
  </div>

  <div class="section">
    <label for="input">Step 2: Review or Paste Data:</label>
    <textarea id="input" placeholder='Paste JSON-LD or upload a file above...'></textarea>
  </div>

  <div class="actions">
    <button id="send">Validate Now</button>
    <button id="clear">Clear All</button>
  </div>

  <div id="output">Results will appear here...</div>

  <script>
    const textarea = document.getElementById('input');
    const filePicker = document.getElementById('filePicker');
    const button = document.getElementById('send');
    const output = document.getElementById('output');
    const clearBtn = document.getElementById('clear');

    // --- NEW: Listen for file selection ---
    filePicker.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      try {
        const text = await readFileAsText(file);
        textarea.value = text; // Inject file content into textarea
        output.innerHTML = `<span style="color:blue;">File "${file.name}" loaded into editor.</span>`;
      } catch (err) {
        output.innerHTML = `<span class="error">Error reading file: ${err.message}</span>`;
      }
    });

    // Helper to read file as text
    const readFileAsText = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsText(file);
      });
    };

    // Send logic remains focused on the textarea
    button.addEventListener('click', async () => {
      const content = textarea.value.trim();

      if (!content) {
        output.innerHTML = '<span class="error">The editor is empty. Paste data or upload a file.</span>';
        return;
      }

      output.innerHTML = 'Processing...';

      try {
        const response = await fetch('http://localhost:3000/validate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/ld+json'
          },
          body: content
        });

        if (!response.ok) throw new Error(`Server error: ${response.status}`);

        const res = await response.json();
        output.innerHTML = res['result'] || 'Validation successful (no details returned).';
      } catch (err) {
        output.innerHTML = `<span class="error">Error: ${err.message}</span>`;
      }
    });

    clearBtn.addEventListener('click', () => {
      textarea.value = '';
      filePicker.value = '';
      output.innerHTML = 'Results will appear here...';
    });
  </script>

</body>
</html>